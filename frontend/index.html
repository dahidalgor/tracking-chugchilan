<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Tracking Quilotoa ‚Äî Prototipo</title>

  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />

  <!-- LEAFLET + PLUGINS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-gpx@1.7.0"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <style>
    :root{
      --nav-bg:#0b1417;          /* header oscuro */
      --hero-txt:#fff;           /* texto sobre hero */
      --primary:#18c1e6;         /* cyan bot√≥n */
      --primary-2:#12a6c7;       /* hover */
      --gold:#85713f;            /* t√≠tulos dorado-olivo */
      --ink:#0e1b1f;             /* texto base */
      --muted:#5f7278;           /* texto secundario */
      --line:#e6eef1;            /* bordes */
      --radius:22px;
      --shadow:0 16px 48px rgba(0,0,0,.16);
      --shadow-sm:0 8px 20px rgba(0,0,0,.12);
      --maxw:1200px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      color:var(--ink);
      background:#fff;
      line-height:1.6;
    }
    img{max-width:100%;display:block}
    a{text-decoration:none;color:inherit}

    .container{
      max-width:var(--maxw);
      margin-inline:auto;
      padding:clamp(16px,3vw,28px);
    }

    /* NAV */
    header{
      position:sticky;
      top:0;
      z-index:40;
      background:var(--nav-bg);
      border-bottom:1px solid rgba(255,255,255,.06)
    }
    .nav{display:flex;align-items:center;gap:18px}
    .menu{display:flex;gap:26px;align-items:center}
    .menu a{
      color:#cde2e7;
      font-weight:800;
      letter-spacing:.2px;
      position:relative;
    }
    .menu a.active::after{
      content:"";
      position:absolute;
      left:0;right:0;bottom:-12px;
      height:3px;
      background:var(--primary);
      border-radius:999px;
    }
    .spacer{flex:1}
    .cta{
      background:var(--primary);
      color:#06333d;
      padding:10px 16px;
      border-radius:999px;
      font-weight:800;
    }
    .cta:hover{background:var(--primary-2)}

    /* HERO */
    .hero{
      position:relative;
      min-height:70vh;
      display:grid;
      place-items:center;
      color:var(--hero-txt);
      text-align:center;
    }
    .hero::before{
      content:"";
      position:absolute;inset:0;
      background:url('https://jrnogales.neocities.org/tracking/imagenes/quilotoa-3.jpg') center/cover no-repeat;
    }
    .hero::after{
      content:"";
      position:absolute;inset:0;
      background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.45));
    }
    .hero-inner{
      position:relative;
      z-index:1;
      max-width:980px;
      padding:0 16px;
    }
    .hero h1{
      font-family:Poppins,system-ui,sans-serif;
      font-weight:800;
      font-size:clamp(2.2rem,5vw,4rem);
      margin:0 0 8px;
    }
    .hero p{
      font-size:clamp(1rem,2.1vw,1.25rem);
      opacity:.98;
      margin:0 0 22px;
    }
    .btn-primary{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:var(--primary);
      color:#06333d;
      padding:14px 22px;
      border-radius:999px;
      font-weight:800;
      box-shadow:var(--shadow-sm);
    }
    .btn-primary:hover{background:var(--primary-2)}

    /* SECCIONES */
    section{scroll-margin-top:90px}
    .section{padding:clamp(36px,6vw,76px) 0}
    .title{
      font-family:Poppins,system-ui,sans-serif;
      font-weight:800;
      color:var(--gold);
      font-size:clamp(1.8rem,3vw,2.6rem);
      text-align:center;
      margin:0 0 8px;
    }
    .subtitle{
      text-align:center;
      color:var(--muted);
      margin:0 0 22px;
    }

    /* Fondo despu√©s del hero */
    .after-hero{
      background:url('https://jrnogales.neocities.org/tracking/imagenes/fondor.jpg') center/cover fixed no-repeat;
    }

    /* MAPA (reemplaza imagen) */
    #map{
      width:100%;
      height:70vh;
      border-radius:18px;
      box-shadow:var(--shadow);
    }

    .map-img{
      width:100%;
      height:auto;
      border-radius:18px;
      box-shadow:var(--shadow);
    }

    .grid{display:grid;gap:18px}
    .cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
    .cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:1024px){
      .cols-4,.cols-3{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width:640px){
      .cols-4,.cols-3{grid-template-columns:1fr}
    }

    .card{
      position:relative;
      border-radius:26px;
      overflow:hidden;
      box-shadow:var(--shadow-sm);
      background:#fff;
    }
    .card .media{
      width:100%;
      aspect-ratio:16/11;
      object-fit:cover;
    }

    /* Ocultar t√≠tulos en hospedaje (solo im√°genes) */
    #hospedaje .overlay{display:none}

    /* GUIAS */
    .guide{
      display:grid;
      grid-template-columns:80px 1fr;
      gap:12px;
      align-items:center;
      padding:14px;
    }
    .guide img{
      width:80px;
      height:80px;
      border-radius:16px;
      object-fit:cover;
    }

    /* Panel de controles y avisos del mapa */
    .panel {
      position:absolute;
      right:12px;
      top:12px;
      z-index:1000;
      display:grid;
      gap:8px;
    }
    .panel button {
      background:#111827;
      color:#fff;
      padding:10px 12px;
      border:none;
      border-radius:10px;
      font:14px system-ui, -apple-system, "Segoe UI", Roboto;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.15);
    }
    .legend {
      position:absolute;
      left:12px;
      bottom:12px;
      z-index:1000;
      background:#fff;
      padding:8px 10px;
      border-radius:10px;
      box-shadow:0 6px 16px rgba(0,0,0,.12);
      font:13px system-ui;
    }
    .legend .sw {
      display:inline-block;
      width:18px;
      height:4px;
      background:#2563eb;
      border-radius:2px;
      vertical-align:middle;
      margin-right:6px;
    }

    .heading-icon { width:36px; height:36px; transform: translate(-18px,-18px); }
    .heading-icon svg { width:36px; height:36px; transform-origin:50% 56%; }
    .heading-shadow { filter: drop-shadow(0 2px 3px rgba(0,0,0,.35)); }

    .banner {
      position:absolute;
      left:50%;
      top:56px;
      transform:translateX(-50%);
      background:#fee2e2;
      color:#991b1b;
      padding:8px 12px;
      border-radius:10px;
      box-shadow:0 6px 16px rgba(0,0,0,.12);
      z-index:1000;
      display:none;
      font:14px system-ui;
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <header>
    <div class="container nav">
      <nav class="menu" aria-label="principal">
        <a class="active" href="#hero">INICIO</a>
        <a href="#ruta">RUTA</a>
        <a href="#hospedaje">HOSPEDAJE</a>
        <a href="#actividades">ACTIVIDADES</a>
        <a href="#guias">GU√çAS</a>
        <a href="#contacto">CONTACTO</a>
      </nav>
      <div class="spacer"></div>
      <a class="cta" href="#ruta">Planificar ruta</a>
    </div>
  </header>

  <!-- HERO -->
  <section id="hero" class="hero" aria-label="Portada">
    <div class="hero-inner">
      <h1>TRACKING QUILOTOA</h1>
      <p>Caminar es solo el comienzo: vive la experiencia andina, comparte con su gente y guarda momentos que quedar√°n para siempre.</p>
      <a class="btn-primary" href="#actividades">Explorar</a>
    </div>
  </section>

  <div class="after-hero">

    <!-- RUTA con mapa avanzado -->
    <section id="ruta" class="section">
      <h2 class="title">LA RUTA</h2>
      <p class="subtitle">Explora el recorrido completo y planifica tus paradas favoritas.</p>
      <div class="container" style="position:relative;">
        <div id="map"></div>

        <div class="panel">
          <button id="btnFollow">üß≠ Seguir ON</button>
          <button id="btnLocate">üìç Mi ubicaci√≥n</button>
          <button id="btnCompass">üß≤ Br√∫jula</button>
        </div>

        <div class="legend">
          <span class="sw"></span>Ruta Quilotoa Trail
        </div>

        <div id="banner" class="banner">Te alejaste de la ruta (&gt;30 m)</div>
      </div>
    </section>

    <!-- HOSPEDAJE (sin filtros y sin t√≠tulos) -->
    <section id="hospedaje" class="section">
      <h2 class="title">Elige tu mejor opci√≥n para hospedarte y relajarte</h2>
      <div id="portfolio" class="container grid cols-4">
        <!-- CHUGCHILAN -->
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=10" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min32-2-1024x683.jpg" alt="Hostal Cloud Forest">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=14" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min541057-1024x683.jpg" alt="Hoster√≠a Puyu Pacha">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=11" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min541024-1024x683.jpg" alt="Lagoon Hotel">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=18" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min541016-1024x683.jpg" alt="Centro Tur√≠stico Quilotoa √ëan">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=13" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min5410-1024x683.jpg" alt="Caba√±a Luna y Miel">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=12" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min51-1024x683.jpg" alt="Hostal Backpackers">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=9" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min19-1024x683.jpg" alt="Hostal Do√±a Clarita">
          </a>
        </article>
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=7" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_2355-min17-1024x683.jpg" alt="El Bautista Camping">
          </a>
        </article>
        <!-- QUILOTOA -->
        <article class="card">
          <a href="https://quilotoatrail.com/admin/establecimiento.php?id=17" target="_blank" rel="noopener">
            <img class="media" src="https://quilotoatrail.com/wp-content/uploads/2024/07/DSC_1712-1024x683.jpg" alt="Hotel Princesa Toa">
          </a>
        </article>
      </div>
    </section>

    <!-- ACTIVIDADES -->
    <section id="actividades" class="section" style="background:#f3f7f9;">
      <h2 class="title">Vive estas experiencias</h2>
      <p class="subtitle">Programas aut√©nticos en granjas y paisajes andinos, operados por la comunidad.</p>
      <div class="container grid cols-4">
        <article class="card">
          <img class="media" src="https://cdn.pixabay.com/photo/2016/08/26/01/55/animals-1621075_1280.jpg" alt="Granja de animales">
        </article>
        <article class="card">
          <img class="media" src="https://panoramaagrario.com/wp-content/uploads/2016/06/cultivos.jpg" alt="Siembra">
        </article>
        <article class="card">
          <img class="media" src="https://www.micebo.es/data/blog/328/images/_mini/post_grd/891/pescar-trucha.jpg?t=20220422b" alt="Pesca deportiva">
        </article>
        <article class="card">
          <img class="media" src="https://losciruelos.es/wp-content/uploads/2017/02/montar-a-caballo-beneficios.jpg" alt="Montar a caballo">
        </article>
      </div>
    </section>

    <!-- GU√çAS -->
    <section id="guias" class="section">
      <h2 class="title">Gu√≠as locales certificados</h2>
      <p class="subtitle">Conocimiento de territorio, seguridad y acompa√±amiento en tu idioma.</p>
      <div class="container grid cols-3">
        <article class="card">
          <div class="guide">
            <img src="https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.ambiente.gob.ec%2Fmae-permite-el-ingreso-de-guias-nacionales-a-12-areas-protegidas-para-fomentar-y-promover-el-turismo%2F&psig=AOvVaw1Uh0UF5idTG937sY428sLr&ust=1761450717805000&source=images&cd=vfe&opi=89978449&ved=0CBUQjRxqFwoTCJiC1LW5vpADFQAAAAAdAAAAABAE" alt="Gu√≠a 1">
            <div><strong>Gu√≠a Local 1</strong><br><span class="subtitle">Espa√±ol / Ingl√©s</span></div>
          </div>
        </article>
        <article class="card">
          <div class="guide">
            <img src="https://ecuadorconventions.org/wp-content/uploads/2025/01/Guianza-Turistica.webp" alt="Gu√≠a 2">
            <div><strong>Gu√≠a Local 2</strong><br><span class="subtitle">Espa√±ol / Franc√©s</span></div>
          </div>
        </article>
        <article class="card">
          <div class="guide">
            <img src="https://travelecuador.org/wp-content/uploads/2022/06/Marco-I-have-a-Mission.jpg" alt="Gu√≠a 3">
            <div><strong>Gu√≠a Local 3</strong><br><span class="subtitle">Espa√±ol</span></div>
          </div>
        </article>
      </div>
    </section>

    <!-- CONTACTO -->
    <section id="contacto" class="section">
      <h2 class="title">¬øListo para empezar?</h2>
      <p class="subtitle">Escr√≠benos fechas, n√∫mero de personas y actividades que te interesan.</p>
      <div class="container" style="display:flex;justify-content:center">
        <a class="btn-primary" href="mailto:info@quilotoatrail.com">Contactar</a>
      </div>
    </section>

  </div>

  <!-- SCRIPT DEL MAPA AVANZADO -->
  <script>
    // ----- MAPA BASE -----
    const map = L.map('map', { zoomControl:true }).setView([-0.9, -78.8], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // ----- RUTA GPX -----
    const gpxUrl = 'quilotoa_trail.gpx';
    const gpxLayer = new L.GPX(gpxUrl, {
      async: true,
      polyline_options: { color:'#2563eb', weight:4, opacity:.95 }
    })
    .on('loaded', e => map.fitBounds(e.target.getBounds(), { padding:[30,30] }))
    .on('error', () => alert('No pude cargar ' + gpxUrl + '. ¬øNombre/ruta correctos?'))
    .addTo(map);

    // Convertimos a l√≠nea para alertas
    let routeLine = null;
    gpxLayer.on('loaded', () => {
      const gj = gpxLayer.toGeoJSON();
      routeLine = (gj.features || [gj]).find(f => f.geometry?.type === 'LineString') || null;
    });

    // ----- MARCADOR TRIANGULAR -----
    function makeHeadingIcon(angleDeg = 0) {
      return L.divIcon({
        className:'heading-icon',
        html:`
          <svg class="heading-shadow" viewBox="0 0 100 100" style="transform:rotate(${angleDeg}deg)">
            <path d="M50 6 L72 68 Q50 58 28 68 Z" fill="#1d4ed8" stroke="#0f3fb1" stroke-width="4" />
            <circle cx="50" cy="58" r="6" fill="#fff" opacity=".9"/>
          </svg>`,
        iconSize:[36,36],
        iconAnchor:[18,18],
      });
    }

    let headingDeg = null;
    let follow = true;
    let youMarker = null;
    let accuracyCircle = null;
    const banner = document.getElementById('banner');

    function showBanner(msg){
      banner.textContent = msg;
      banner.style.display='block';
      setTimeout(()=> banner.style.display='none', 2400);
    }

    function checkOffRoute(latlng){
      if (!routeLine) return;
      const p = turf.point([latlng.lng, latlng.lat]);
      const dist = turf.pointToLineDistance(p, routeLine, {units:'meters'});
      if (dist > 30) showBanner('Te alejaste de la ruta (~' + dist.toFixed(0) + ' m)');
    }

    // ----- GEOLOC (bot√≥n Mi ubicaci√≥n) -----
    document.getElementById('btnLocate').addEventListener('click', () => {
      map.locate({ watch:true, setView:true, maxZoom:17, enableHighAccuracy:true });
    });

    map.on('locationfound', (e) => {
      const latlng = e.latlng;

      if (!youMarker) {
        youMarker = L.marker(latlng, {
          icon: makeHeadingIcon(headingDeg ?? 0), zIndexOffset:1000
        }).addTo(map);
      } else {
        youMarker.setLatLng(latlng);
        const el = youMarker.getElement()?.querySelector('svg');
        if (el && headingDeg != null) el.style.transform = `rotate(${headingDeg}deg)`;
      }

      if (!accuracyCircle) {
        accuracyCircle = L.circle(latlng, {
          radius:e.accuracy||15,
          weight:1,
          color:'#2563eb',
          opacity:.6
        }).addTo(map);
      } else {
        accuracyCircle.setLatLng(latlng);
        accuracyCircle.setRadius(e.accuracy||15);
      }

      if (follow) map.setView(latlng, Math.max(map.getZoom(), 16), { animate:false });

      checkOffRoute(latlng);
    });

    map.on('locationerror', (e) => {
      alert(
        "‚ö†Ô∏è No se pudo obtener ubicaci√≥n.\n\n" +
        "Detalle: " + e.message + " (code " + e.code + ")\n\n" +
        "Prueba:\n" +
        "‚Ä¢ Abrir en navegador con HTTPS\n" +
        "‚Ä¢ Activar permisos de ubicaci√≥n\n" +
        "‚Ä¢ Activar Ubicaci√≥n precisa en el dispositivo"
      );
    });

    // ----- BR√öJULA -----
    function handleOrientation(ev){
      if (typeof ev.alpha === 'number') {
        headingDeg = 360 - ev.alpha;
        const el = youMarker?.getElement()?.querySelector('svg');
        if (el) el.style.transform = `rotate(${headingDeg}deg)`;
      }
    }

    async function enableCompass(){
      try {
        if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
          const state = await DeviceOrientationEvent.requestPermission();
          if (state !== 'granted') return alert('Permiso de br√∫jula denegado');
        }
        window.addEventListener('deviceorientation', handleOrientation, { passive:true });
        alert('Br√∫jula activada');
      } catch {
        alert('Tu navegador no permite br√∫jula');
      }
    }
    document.getElementById('btnCompass').onclick = enableCompass;

    // ----- Toggle seguir -----
    document.getElementById('btnFollow').onclick = (ev) => {
      follow = !follow;
      ev.target.textContent = follow ? "üß≠ Seguir ON" : "üß≠ Seguir OFF";
      showBanner(follow ? "Seguir activado" : "Seguir desactivado");
    };
  </script>
</body>
</html>

